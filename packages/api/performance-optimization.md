# üöÄ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π Telegram

## ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ: –ï–¥–∏–Ω—ã–π –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π

### –ü—Ä–æ–±–ª–µ–º–∞ (–¥–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏)

–û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞–∂–¥–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ Telegram —Ç—Ä–µ–±–æ–≤–∞–ª–∞ **2 –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö AI –≤—ã–∑–æ–≤–∞**:

1. `classifyRelevance()` - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏ —Å–æ–æ–±—â–µ–Ω–∏—è
2. `classifyMessageType()` - –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —Ç–∏–ø–∞ —Å–æ–æ–±—â–µ–Ω–∏—è

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –º–µ–¥–ª–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞, –¥–≤–æ–π–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ AI API

### –†–µ—à–µ–Ω–∏–µ (–ø–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏)

–°–æ–∑–¥–∞–Ω **–µ–¥–∏–Ω—ã–π –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä** `classifyMessage()`, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–ø–æ–ª–Ω—è–µ—Ç –æ–±–µ –∑–∞–¥–∞—á–∏ –∑–∞ **–æ–¥–∏–Ω AI –≤—ã–∑–æ–≤**.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. –ï–¥–∏–Ω—ã–π –ø—Ä–æ–º–ø—Ç

- **–§–∞–π–ª**: `packages/prompts/src/prompts/message-classifier.ts`
- **–ö–ª—é—á**: `message-classifier`
- **–§—É–Ω–∫—Ü–∏—è**: –û–±—ä–µ–¥–∏–Ω—è–µ—Ç –ª–æ–≥–∏–∫—É –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏ –∏ —Ç–∏–ø–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JSON —Å –æ–±–µ–∏–º–∏ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è–º–∏

### 2. –ï–¥–∏–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏

- **–§–∞–π–ª**: `packages/api/src/lib/ai/classifier.ts`
- **–§—É–Ω–∫—Ü–∏—è**: `classifyMessage()`
- **–ó–∞–º–µ–Ω—è–µ—Ç**: –£–¥–∞–ª–µ–Ω–Ω—ã–µ `classifyRelevance()` –∏ `classifyMessageType()`
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: `{ messageType, relevance }` –∑–∞ –æ–¥–∏–Ω –≤—ã–∑–æ–≤

### 3. –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏

- **–§–∞–π–ª**: `packages/api/src/router/messages/process-message.ts`
- **–ò–∑–º–µ–Ω–µ–Ω–∏—è**:
  - –£–±—Ä–∞–Ω–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç—å A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–µ—Ç–æ–¥
  - –î–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- **~50% —É—Å–∫–æ—Ä–µ–Ω–∏–µ** –≤—Ä–µ–º–µ–Ω–∏ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏
- **–ú–µ–Ω—å—à–µ latency** –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π Telegram –±–æ—Ç–∞
- **–£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** - –º–µ–Ω—å—à–µ –∫–æ–¥–∞, –º–µ–Ω—å—à–µ –æ—à–∏–±–æ–∫

### üí∞ –≠–∫–æ–Ω–æ–º–∏—è

- **~50% —Å–Ω–∏–∂–µ–Ω–∏–µ** —Ä–∞—Å—Ö–æ–¥–æ–≤ –Ω–∞ AI API
- **–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –∫–∞—á–µ—Å—Ç–≤–æ** –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏
- **–ï–¥–∏–Ω–æ–µ –º–µ—Å—Ç–æ** –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–º–ø—Ç–∞

### üîß –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–í –ª–æ–≥–∞—Ö API –≤–∏–¥–Ω–æ:

```
üöÄ Using unified message classification
‚è±Ô∏è Classification took 847ms
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–∞

–ï–¥–∏–Ω—ã–π –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç:

```json
{
  "messageType": {
    "type": "question" | "event" | "chat" | "irrelevant",
    "subtype": string | null,
    "confidence": number,
    "need_logging": boolean
  },
  "relevance": {
    "relevant": boolean,
    "score": number,
    "category": "relevant" | "irrelevant" | "spam"
  }
}
```

## –£–¥–∞–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- ‚ùå `packages/prompts/src/prompts/classifier.relevance.ts`
- ‚ùå `packages/prompts/src/prompts/classifier.message-type.ts`
- ‚ùå –§—É–Ω–∫—Ü–∏–∏ `classifyRelevance()` –∏ `classifyMessageType()`
- ‚ùå Legacy –ª–æ–≥–∏–∫–∞ A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

## –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã

- ‚úÖ `packages/prompts/src/prompts/message-classifier.ts`
- ‚úÖ –§—É–Ω–∫—Ü–∏—è `classifyMessage()`
- ‚úÖ –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏

–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –°–∏—Å—Ç–µ–º–∞ —Å—Ç–∞–ª–∞ –±—ã—Å—Ç—Ä–µ–µ, –¥–µ—à–µ–≤–ª–µ –∏ –ø—Ä–æ—â–µ –≤ –ø–æ–¥–¥–µ—Ä–∂–∫–µ.
