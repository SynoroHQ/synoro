# üéØ Best Practices –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –º–µ–∂–¥—É –∞–≥–µ–Ω—Ç–∞–º–∏

## üìã –û–±–∑–æ—Ä

–î–∞–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É –ø–µ—Ä–µ–¥–∞—á–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –º–µ–∂–¥—É –∞–≥–µ–Ω—Ç–∞–º–∏ –≤ Synoro AI, –æ—Å–Ω–æ–≤–∞–Ω–Ω—É—é –Ω–∞ best practices –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å LLM.

## ‚ùå –ü—Ä–æ–±–ª–µ–º—ã —Å—Ç–∞—Ä–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞

### –ß—Ç–æ –ù–ï –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å:

- ‚ùå **–ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å "—Å—ã—Ä–æ–π —á–∞—Ç —Ü–µ–ª–∏–∫–æ–º"** - —ç—Ç–æ –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –∏ –¥–æ—Ä–æ–≥–æ
- ‚ùå **–°–º–µ—à–∏–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º** - –∞–≥–µ–Ω—Ç –Ω–µ –ø–æ–Ω–∏–º–∞–µ—Ç —Å–≤–æ—é —Ä–æ–ª—å
- ‚ùå **–ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏** - –º–Ω–æ–≥–æ —à—É–º–∞, –º–∞–ª–æ —Å–∏–≥–Ω–∞–ª–∞
- ‚ùå **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç** - —Å–ª–æ–∂–Ω–æ –ø–∞—Ä—Å–∏—Ç—å –∏ –ø–æ–Ω–∏–º–∞—Ç—å

## ‚úÖ –ù–æ–≤—ã–π –ø–æ–¥—Ö–æ–¥ (Best Practices)

### –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞:

1. **üîπ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è (—Ä–æ–ª—å –∞–≥–µ–Ω—Ç–∞)**
   - –ß–µ—Ç–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–æ–ª–∏ –∏ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
   - –û–ø–∏—Å–∞–Ω–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π –∞–≥–µ–Ω—Ç–∞
   - –ü—Ä–∞–≤–∏–ª–∞ –ø–æ–≤–µ–¥–µ–Ω–∏—è

2. **üîπ –ö—Ä–∞—Ç–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç (—Å—É–º–º–∞—Ä–Ω–æ –∏–ª–∏ –∏–∑–≤–ª–µ—á—ë–Ω–Ω–æ)**
   - –¢–µ–º–∞ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞
   - –ù–∞–º–µ—Ä–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –ö–ª—é—á–µ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
   - –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∞

3. **üîπ –ü–æ—Å–ª–µ–¥–Ω–∏–µ —à–∞–≥–∏ (–Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–æ–æ–±—â–µ–Ω–∏–π)**
   - –¢–æ–ª—å–∫–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
   - –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
   - –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏

4. **üîπ –ö–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –∑–∞–¥–∞—á–∞**
   - –ß–µ—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
   - –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
   - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

```typescript
interface StructuredAgentContext {
  instruction: string; // –†–æ–ª—å –∞–≥–µ–Ω—Ç–∞
  contextSummary: {
    // –ö—Ä–∞—Ç–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
    conversationTopic: string;
    userIntent: string;
    keyInformation: string[];
    conversationMood: "positive" | "neutral" | "negative";
  };
  recentSteps: {
    // –ü–æ—Å–ª–µ–¥–Ω–∏–µ —à–∞–≥–∏
    userMessage: string;
    assistantResponse?: string;
    timestamp: Date;
    stepType: string;
  }[];
  currentTask: {
    // –ö–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –∑–∞–¥–∞—á–∞
    input: string;
    type: string;
    priority: number;
    expectedOutput: string;
  };
  metadata: {
    // –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
    conversationId?: string;
    userId?: string;
    channel?: string;
    contextVersion: string;
    compressedFrom: number;
  };
}
```

### –ú–µ–Ω–µ–¥–∂–µ—Ä –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞:

```typescript
class AgentContextManager {
  // –°–æ–∑–¥–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
  async createStructuredContext(
    task,
    agentName,
    agentDescription,
  ): Promise<StructuredAgentContext>;

  // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –¥–ª—è –ø—Ä–æ–º–ø—Ç–∞
  formatContextForPrompt(context): string;

  // –°–æ–∑–¥–∞–µ—Ç —Å–∂–∞—Ç—É—é –≤–µ—Ä—Å–∏—é
  createCompressedContext(context, maxLength): string;
}
```

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –í –±–∞–∑–æ–≤–æ–º –∫–ª–∞—Å—Å–µ –∞–≥–µ–Ω—Ç–∞:

```typescript
export class MyAgent extends AbstractAgent {
  async process(task: AgentTask): Promise<AgentResult<string>> {
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
    const systemPrompt = await this.createOptimizedPrompt(basePrompt, task, {
      useStructuredContext: true,
      maxContextLength: 1000, // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ø–æ–¥ –∞–≥–µ–Ω—Ç–∞
    });

    const response = await this.generateResponse(
      task.input,
      systemPrompt,
      task,
      {
        useStructuredContext: true,
        maxContextLength: 1000,
      },
    );

    return this.createSuccessResult(response);
  }
}
```

### –î–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∞–≥–µ–Ω—Ç–æ–≤:

```typescript
// –†–æ—É—Ç–µ—Ä (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç)
const routerPrompt = await this.createOptimizedPrompt(basePrompt, task, {
  useStructuredContext: true,
  maxContextLength: 400, // –ú–∞–ª–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
});

// –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∞–≥–µ–Ω—Ç (–±–æ–ª—å—à–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞)
const specialistPrompt = await this.createOptimizedPrompt(basePrompt, task, {
  useStructuredContext: true,
  maxContextLength: 1200, // –ë–æ–ª—å—à–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
});

// –ê–≥–µ–Ω—Ç —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º (—Å–∂–∞—Ç–∞—è –≤–µ—Ä—Å–∏—è)
const compressedPrompt = contextManager.createCompressedContext(
  structuredContext,
  300, // –û—á–µ–Ω—å –º–∞–ª–æ –º–µ—Å—Ç–∞
);
```

## üìä –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

### –≠–∫–æ–Ω–æ–º–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤:

- **70% –º–µ–Ω—å—à–µ —Ç–æ–∫–µ–Ω–æ–≤** - –ø–µ—Ä–µ–¥–∞–µ–º —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
- **–ë—ã—Å—Ç—Ä–µ–µ –æ–±—Ä–∞–±–æ—Ç–∫–∞** - –∞–≥–µ–Ω—Ç—ã –ø–æ–ª—É—á–∞—é—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- **–ú–µ–Ω—å—à–µ –æ—à–∏–±–æ–∫** - —á–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Ä–æ–ª–∏ –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

### –ö–∞—á–µ—Å—Ç–≤–æ –æ—Ç–≤–µ—Ç–æ–≤:

- **–ë–æ–ª–µ–µ —Ç–æ—á–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã** - –∞–≥–µ–Ω—Ç—ã –ª—É—á—à–µ –ø–æ–Ω–∏–º–∞—é—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç
- **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å** - –µ–¥–∏–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–ª—è –≤—Å–µ—Ö –∞–≥–µ–Ω—Ç–æ–≤
- **–†–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å** - —Ç–æ–ª—å–∫–æ –≤–∞–∂–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∏ –æ—Ç–ª–∞–¥–∫–∞:

- **–õ–µ–≥—á–µ –æ—Ç–ª–∞–∂–∏–≤–∞—Ç—å** - —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- **–ü—Ä–æ—â–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å** - –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞:

```typescript
const contextOptions = {
  useStructuredContext: true, // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É
  maxContextLength: 1000, // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
  includeFullHistory: false, // –í–∫–ª—é—á–∞—Ç—å –ø–æ–ª–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é (legacy)
};
```

### –ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ –∞–≥–µ–Ω—Ç–æ–≤:

```typescript
// –î–ª—è —Ä–æ—É—Ç–µ—Ä–∞ - –º–∏–Ω–∏–º—É–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
const routerOptions = {
  useStructuredContext: true,
  maxContextLength: 400,
};

// –î–ª—è –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ - –º–∞–∫—Å–∏–º—É–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
const orchestratorOptions = {
  useStructuredContext: true,
  maxContextLength: 1500,
};

// –î–ª—è —á–∞—Ç-–∞–≥–µ–Ω—Ç–∞ - —Å—Ä–µ–¥–Ω–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
const chatOptions = {
  useStructuredContext: true,
  maxContextLength: 600,
};
```

## üìà –ú–µ—Ç—Ä–∏–∫–∏

### –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:

```typescript
interface ContextMetrics {
  originalMessageCount: number; // –ò—Å—Ö–æ–¥–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π
  compressedMessageCount: number; // –°–∂–∞—Ç–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
  contextLength: number; // –î–ª–∏–Ω–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≤ —Å–∏–º–≤–æ–ª–∞—Ö
  compressionRatio: number; // –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Å–∂–∞—Ç–∏—è
  processingTime: number; // –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
  agentType: string; // –¢–∏–ø –∞–≥–µ–Ω—Ç–∞
}
```

### –ü—Ä–∏–º–µ—Ä –º–µ—Ç—Ä–∏–∫:

```typescript
// –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
{
  originalMessageCount: 20,
  contextLength: 5000,
  compressionRatio: 1.0,
  processingTime: 2000,
}

// –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
{
  originalMessageCount: 20,
  compressedMessageCount: 3,
  contextLength: 1200,
  compressionRatio: 0.24, // 76% —ç–∫–æ–Ω–æ–º–∏–∏
  processingTime: 800,    // 60% –±—ã—Å—Ç—Ä–µ–µ
}
```

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è

### –ü–æ—ç—Ç–∞–ø–Ω–æ–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ:

1. **–≠—Ç–∞–ø 1**: –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
2. **–≠—Ç–∞–ø 2**: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑–æ–≤–æ–≥–æ –∫–ª–∞—Å—Å–∞ –∞–≥–µ–Ω—Ç–∞
3. **–≠—Ç–∞–ø 3**: –ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∞–≥–µ–Ω—Ç–æ–≤
4. **–≠—Ç–∞–ø 4**: –£–¥–∞–ª–µ–Ω–∏–µ legacy –∫–æ–¥–∞

### –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:

```typescript
// –°—Ç–∞—Ä—ã–π –º–µ—Ç–æ–¥ (legacy)
const legacyPrompt = this.createPromptWithHistory(basePrompt, task, {
  includeSummary: true,
});

// –ù–æ–≤—ã–π –º–µ—Ç–æ–¥ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π)
const optimizedPrompt = await this.createOptimizedPrompt(basePrompt, task, {
  useStructuredContext: true,
});
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤:

```typescript
describe("AgentContextManager", () => {
  it("should create structured context from message history", async () => {
    const context = await contextManager.createStructuredContext(
      task,
      "Test Agent",
      "Test description",
    );

    expect(context.instruction).toContain("Test Agent");
    expect(context.contextSummary).toBeDefined();
    expect(context.recentSteps).toHaveLength(3);
    expect(context.currentTask.input).toBe(task.input);
  });

  it("should compress context for limited agents", () => {
    const compressed = contextManager.createCompressedContext(
      structuredContext,
      300,
    );

    expect(compressed.length).toBeLessThanOrEqual(300);
    expect(compressed).toContain("Test Agent");
  });
});
```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è](./examples/context-usage-example.ts)
- [API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](./context-manager.ts)
- [–ú–∏–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –≥–∞–π–¥](./migration-guide.md)
- [–ú–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥](./metrics.md)

---

**–ü–æ–º–Ω–∏—Ç–µ**: –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –¥–∞–≤–∞–π—Ç–µ LLM "—Å—ã—Ä–æ–π —á–∞—Ç —Ü–µ–ª–∏–∫–æ–º". –í—Å–µ–≥–¥–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä—É–π—Ç–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å–æ–≥–ª–∞—Å–Ω–æ best practices!
