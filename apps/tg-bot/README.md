# @synoro/tg-bot

Telegram-бот для сервиса «универсальный цифровой мозг для дома»: принимает текст и голосовые сообщения, транскрибирует аудио через OpenAI Whisper и отвечает пользователю.

## Возможности
- Понимание текстовых сообщений
- Понимание голосовых/аудио сообщений (скачивание файла из Telegram, транскрибация в текст с помощью OpenAI)
- Режим long-polling (подходит для локальной разработки)

## Переменные окружения
Добавьте в корневой `.env` (пример в `.env.example`):

```
TELEGRAM_BOT_TOKEN="<из @BotFather>"
OPENAI_API_KEY="<из https://platform.openai.com>"
# (опционально)
OPENAI_TRANSCRIBE_MODEL="whisper-1" # или gpt-4o-mini-transcribe
```

## Установка и запуск
1. Установить зависимости в корне монорепо:
   ```sh
   bun install
   ```
2. Применить миграции/синхронизацию схемы БД (создаст таблицу `event_log`):
   ```sh
   bun run db:push
   ```
3. Запустить бота (long-polling):
   ```sh
   bun run dev
   ```
   (в каталоге `apps/tg-bot/`)

Бот начнет принимать сообщения. Отправьте ему текст или голосовое сообщение — он ответит распознанным текстом.

## Стек
- Runtime: Bun / Node >= 22
- Telegram SDK: grammy
- OpenAI SDK: openai v4
- TypeScript

## Дальнейшие шаги
- Расширить схему событий (в `packages/db/src/schemas/events/`) — сейчас сохраняются source/chatId/type/text/meta/createdAt
- Генерация советов на основании истории событий (tRPC/сервис рекомендаций)
- Переключение на webhook-режим для продакшена
