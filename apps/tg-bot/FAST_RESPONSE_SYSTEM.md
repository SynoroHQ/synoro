# üöÄ Fast Response System

## –û–±–∑–æ—Ä

**Fast Response System** - —ç—Ç–æ –∏–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –º–≥–Ω–æ–≤–µ–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ –¥–ª—è Telegram –±–æ—Ç–∞, –∫–æ—Ç–æ—Ä–∞—è –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:

- ‚ö° **–ú–≥–Ω–æ–≤–µ–Ω–Ω—É—é —Ä–µ–∞–∫—Ü–∏—é** –Ω–∞ –ø—Ä–æ—Å—Ç—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- üöÄ **–£–ª—É—á—à–µ–Ω–Ω—ã–π UX** –∑–∞ —Å—á–µ—Ç –±—ã—Å—Ç—Ä—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
- üí° **–†–∞–∑–≥—Ä—É–∑–∫—É –º—É–ª—å—Ç–∏–∞–≥–µ–Ω—Ç–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã** –æ—Ç –ø—Ä–æ—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- üîÑ **–ì–∏–±–∫—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É** –ø—Ä–∞–≤–∏–ª –æ—Ç–≤–µ—Ç–æ–≤

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 1. –ê–Ω–∞–ª–∏–∑ —Å–æ–æ–±—â–µ–Ω–∏—è

–ö–∞–∂–¥–æ–µ –≤—Ö–æ–¥—è—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è —Å–∏—Å—Ç–µ–º–æ–π –±—ã—Å—Ç—Ä—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤:

```typescript
const fastResponse = fastResponseSystem.analyzeMessage(text);

if (fastResponse.shouldSendFast) {
  // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –±—ã—Å—Ç—Ä—ã–π –æ—Ç–≤–µ—Ç
  await ctx.reply(fastResponse.fastResponse);

  // –ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –ø–æ–ª–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞, –∑–∞–ø—É—Å–∫–∞–µ–º –≤ —Ñ–æ–Ω–µ
  if (fastResponse.needsFullProcessing) {
    processMessageInBackground(text, messageContext, ctx);
  }
} else {
  // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ –º—É–ª—å—Ç–∏–∞–≥–µ–Ω—Ç—ã
  processWithMultiAgents(text, messageContext);
}
```

### 2. –¢–∏–ø—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏

- **`simple`** - —Ç–æ–ª—å–∫–æ –±—ã—Å—Ç—Ä—ã–π –æ—Ç–≤–µ—Ç, –±–µ–∑ –º—É–ª—å—Ç–∏–∞–≥–µ–Ω—Ç–æ–≤
- **`agents`** - –±—ã—Å—Ç—Ä—ã–π –æ—Ç–≤–µ—Ç + –æ–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ—Ä–µ–∑ –º—É–ª—å—Ç–∏–∞–≥–µ–Ω—Ç–æ–≤ –≤ —Ñ–æ–Ω–µ
- **`none`** - –ø—Ä—è–º–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ –º—É–ª—å—Ç–∏–∞–≥–µ–Ω—Ç—ã

## –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞

### –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è

- `–ø—Ä–∏–≤–µ—Ç`, `–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π`, `hi`, `hello`
- –û—Ç–≤–µ—Ç: "üëã –ü—Ä–∏–≤–µ—Ç! –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?"

### –ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏

- `—Å–ø–∞—Å–∏–±–æ`, `–±–ª–∞–≥–æ–¥–∞—Ä—é`, `thanks`
- –û—Ç–≤–µ—Ç: "üôè –†–∞–¥ –±—ã–ª –ø–æ–º–æ—á—å!"

### –í—Ä–µ–º—è –∏ –¥–∞—Ç–∞

- `–∫–æ—Ç–æ—Ä—ã–π —á–∞—Å`, `–≤—Ä–µ–º—è`, `–∫–∞–∫–∞—è –¥–∞—Ç–∞`, `—Å–µ–≥–æ–¥–Ω—è`
- –û—Ç–≤–µ—Ç: –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –∏ –¥–∞—Ç–∞

### –°—Ç–∞—Ç—É—Å

- `–∫–∞–∫ –¥–µ–ª–∞`, `–∫–∞–∫ —Ç—ã`, `how are you`
- –û—Ç–≤–µ—Ç: "üòä –°–ø–∞—Å–∏–±–æ, —É –º–µ–Ω—è –≤—Å–µ –æ—Ç–ª–∏—á–Ω–æ! –ì–æ—Ç–æ–≤ –ø–æ–º–æ–≥–∞—Ç—å –≤–∞–º!"

### –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- `—á—Ç–æ —É–º–µ–µ—à—å`, `–ø–æ–º–æ—â—å`, `help`
- –û—Ç–≤–µ—Ç: —Å–ø–∏—Å–æ–∫ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π –±–æ—Ç–∞

### –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

- `–¥–∞`, `–Ω–µ—Ç`, `–æ–∫`, `—Ö–æ—Ä–æ—à–æ`, `–ø–æ–Ω—è—Ç–Ω–æ`
- –û—Ç–≤–µ—Ç: "üëç –ü–æ–Ω—è–ª!"

## –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª

```typescript
import { fastResponseSystem } from "../utils/fast-response-system";

// –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ –ø—Ä–∞–≤–∏–ª–æ
fastResponseSystem.addRule({
  pattern: /–ø–æ–≥–æ–¥–∞/i,
  response:
    "üå§Ô∏è –ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, —è –Ω–µ –º–æ–≥—É –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–≥–æ–¥—É. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã!",
  confidence: 0.8,
  needsFullProcessing: false,
});
```

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞–º–∏

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞

```typescript
fastResponseSystem.addRule(rule: FastResponseRule);
```

### –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞

```typescript
fastResponseSystem.removeRule(pattern: string | RegExp);
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

```typescript
const stats = fastResponseSystem.getStats();
console.log(`–í—Å–µ–≥–æ –ø—Ä–∞–≤–∏–ª: ${stats.totalRules}`);
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–∞–≤–∏–ª–∞

```typescript
interface FastResponseRule {
  pattern: string | RegExp; // –ü–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è –ø–æ–∏—Å–∫–∞
  response: string; // –û—Ç–≤–µ—Ç
  confidence: number; // –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å (0-1)
  needsFullProcessing: boolean; // –ù—É–∂–Ω–∞ –ª–∏ –ø–æ–ª–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
}
```

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞–º–∏

### Smart Text Handler

```typescript
export async function handleSmartText(ctx: Context) {
  const fastResponse = fastResponseSystem.analyzeMessage(text);

  if (fastResponse.shouldSendFast) {
    await ctx.reply(fastResponse.fastResponse);

    if (fastResponse.needsFullProcessing) {
      processMessageInBackground(text, messageContext, ctx);
    }
    return;
  }

  // –û–±—ã—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ—Ä–µ–∑ –º—É–ª—å—Ç–∏–∞–≥–µ–Ω—Ç–æ–≤
  processWithMultiAgents(text, messageContext);
}
```

### Text Handler

```typescript
export async function handleText(ctx: Context) {
  const fastResponse = fastResponseSystem.analyzeMessage(text);

  if (fastResponse.shouldSendFast) {
    await ctx.reply(fastResponse.fastResponse);
    return;
  }

  // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç
  await ctx.reply(
    "–ü–æ–Ω—è–ª –≤–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ! –î–ª—è –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É /smart",
  );
}
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. **‚ö° –°–∫–æ—Ä–æ—Å—Ç—å** - –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –Ω–∞ –ø—Ä–æ—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã
2. **üöÄ UX** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç–≤–µ—Ç —Å—Ä–∞–∑—É
3. **üí° –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å** - —Ä–∞–∑–≥—Ä—É–∑–∫–∞ –º—É–ª—å—Ç–∏–∞–≥–µ–Ω—Ç–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
4. **üîÑ –ì–∏–±–∫–æ—Å—Ç—å** - –ª–µ–≥–∫–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –∏ —Ä–∞—Å—à–∏—Ä—è—Ç—å
5. **üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–∞–≤–∏–ª
6. **üé® –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è** - –ø—Ä–æ—Å—Ç–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø—Ä–∞–≤–∏–ª

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
bun test ./tests/fast-response-system.test.ts

# –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è
bun run src/scripts/demo-fast-response.ts
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞. –ü—Ä–∞–≤–∏–ª–∞ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏ –º–æ–≥—É—Ç –±—ã—Ç—å –∏–∑–º–µ–Ω–µ–Ω—ã –≤ runtime.

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è:

- `‚ö° Fast response triggered: simple` - –±—ã—Å—Ç—Ä—ã–π –æ—Ç–≤–µ—Ç
- `üîÑ Starting background processing` - –∑–∞–ø—É—Å–∫ —Ñ–æ–Ω–æ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
- `üîÑ Processing message through multi-agent system` - –ø—Ä—è–º–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞

## –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

- [ ] –ú–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª
- [ ] A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤
- [ ] –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø—Ä–∞–≤–∏–ª
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ API –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
- [ ] –ú–Ω–æ–≥–æ—è–∑—ã—á–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞
