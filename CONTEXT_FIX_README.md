# üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

## üéØ –û–±–∑–æ—Ä

–≠—Ç–æ—Ç –Ω–∞–±–æ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –æ–ø–∏—Å—ã–≤–∞–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≤ –ø—Ä–æ–º–ø—Ç–∞—Ö –∞–≥–µ–Ω—Ç–æ–≤ —Å–∏—Å—Ç–µ–º—ã Synoro AI.

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ `{{userId}}`, `{{householdId}}`, `{{currentTime}}`, `{{timezone}}`, `{{messageHistory}}`, `{{eventContext}}` –Ω–µ –∑–∞–º–µ–Ω—è–ª–∏—Å—å –≤ –ø—Ä–æ–º–ø—Ç–∞—Ö.

**–†–µ—à–µ–Ω–∏–µ:** –í–Ω–µ–¥—Ä–µ–Ω `PromptContextService` –¥–ª—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Å–µ—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.

## üìñ –î–æ–∫—É–º–µ–Ω—Ç—ã

### üöÄ –î–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞

- **[QUICK_START_CONTEXT_FIX.md](QUICK_START_CONTEXT_FIX.md)** - –Ω–∞—á–Ω–∏—Ç–µ –∑–¥–µ—Å—å! –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞ 5 –º–∏–Ω—É—Ç

### üìã –î–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

- **[CONTEXT_VARIABLES_FIX_SUMMARY.md](CONTEXT_VARIABLES_FIX_SUMMARY.md)** - –∫—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- **[CHANGES_SUMMARY.md](CHANGES_SUMMARY.md)** - –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

### üîç –î–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∏–∑—É—á–µ–Ω–∏—è

- **[PROMPT_CONTEXT_FIX.md](PROMPT_CONTEXT_FIX.md)** - –ø–æ–¥—Ä–æ–±–Ω–æ–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

### ‚úÖ –î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

- **[VERIFICATION_CHECKLIST.md](VERIFICATION_CHECKLIST.md)** - —á–µ–∫–ª–∏—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

## üé¨ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `.env`

```bash
USE_PROMPT_CONTEXT_SERVICE="true"
DEBUG_PROMPTS="true"
```

### 2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

```bash
bun run dev
```

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É

–û—Ç–ø—Ä–∞–≤—å—Ç–µ –±–æ—Ç—É –≤ Telegram:

- "–ü—Ä–∏–≤–µ—Ç!"
- "–ü–æ—Ç—Ä–∞—Ç–∏–ª 1500‚ÇΩ –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç—ã"
- "–ü–æ–∫–∞–∂–∏ –º–æ–∏ —Ç—Ä–∞—Ç—ã"

### 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏

–î–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–ø–∏—Å–∏:

```
Prompt processing completed: {
  placeholdersReplaced: ["messageHistory", "userId", ...],
  historyMessagesCount: 2,
  ...
}
```

## üîß –ß—Ç–æ –±—ã–ª–æ –∏–∑–º–µ–Ω–µ–Ω–æ

### –û—Å–Ω–æ–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

1. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `timezone` –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç –∑–∞–¥–∞—á–∏
2. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ `{{eventContext}}`
3. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `getPrompt()` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ `PromptContextService`
4. ‚úÖ –í—Å–µ –∞–≥–µ–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç `PromptContextService`
5. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `.env` –∏ `.env.example`
- `packages/api/src/lib/services/prompt-context-service.ts`
- `packages/prompts/src/prompt-service.ts`
- `packages/api/src/router/messages/process-message-agents.ts`
- `packages/api/src/lib/agents/general-assistant-agent.ts`
- `packages/api/src/lib/agents/event-processor-agent.ts`
- `packages/api/src/lib/agents/event-analyzer-agent.ts`

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –î–æ

‚ùå –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–µ –∑–∞–º–µ–Ω—è–ª–∏—Å—å  
‚ùå –ò—Å—Ç–æ—Ä–∏—è –Ω–µ –ø–µ—Ä–µ–¥–∞–≤–∞–ª–∞—Å—å  
‚ùå –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–æ–±—ã—Ç–∏–π –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª

### –ü–æ—Å–ª–µ

‚úÖ –í—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞–º–µ–Ω—è—é—Ç—Å—è  
‚úÖ –ò—Å—Ç–æ—Ä–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç  
‚úÖ –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–æ–±—ã—Ç–∏–π –¥–æ—Å—Ç—É–ø–µ–Ω  
‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

## üéØ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è           | –û–ø–∏—Å–∞–Ω–∏–µ         | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é                        |
| -------------------- | ---------------- | ----------------------------------- |
| `{{userId}}`         | ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è  | "anonymous"                         |
| `{{householdId}}`    | ID –¥–æ–º–æ—Ö–æ–∑—è–π—Å—Ç–≤–∞ | "none"                              |
| `{{currentTime}}`    | –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è    | ISO timestamp                       |
| `{{timezone}}`       | –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å     | "UTC"                               |
| `{{messageHistory}}` | –ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–∞  | "–ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–∞ –ø—É—Å—Ç–∞"             |
| `{{eventContext}}`   | –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–æ–±—ã—Ç–∏–π | "–°–æ–±—ã—Ç–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã" |

## üîç –û—Ç–ª–∞–¥–∫–∞

### –í–∫–ª—é—á–∏—Ç—å –æ—Ç–ª–∞–¥–æ—á–Ω—ã–µ –ª–æ–≥–∏

```bash
# –í .env
DEBUG_PROMPTS="true"
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏

```bash
# –ò—â–∏—Ç–µ —Å—Ç—Ä–æ–∫–∏:
# - "Prompt processing completed"
# - "placeholdersReplaced"
# - "historyMessagesCount"
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Langfuse

1. –û—Ç–∫—Ä–æ–π—Ç–µ Langfuse Dashboard
2. –ù–∞–π–¥–∏—Ç–µ –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Ç—Ä–µ–π—Å—ã
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—Ä–æ–º–ø—Ç—ã –Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç `{{...}}`

## ‚ö†Ô∏è –í–∞–∂–Ω–æ

1. **–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ** `USE_PROMPT_CONTEXT_SERVICE="true"`
2. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ** –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è `.env`
3. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ª–æ–≥–∏** –ø–µ—Ä–≤—ã–µ 24 —á–∞—Å–∞ –ø–æ—Å–ª–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ Langfuse** –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫

## üÜò –ü—Ä–æ–±–ª–µ–º—ã?

### –ü–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã –Ω–µ –∑–∞–º–µ–Ω—è—é—Ç—Å—è

‚Üí –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `USE_PROMPT_CONTEXT_SERVICE="true"` –≤ `.env`

### –ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞—è

‚Üí –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `conversationId` –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ

### Timezone –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

‚Üí –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `metadata.timezone` –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–¥–∞—á–∏

### –û—à–∏–±–∫–∏ –≤ –ª–æ–≥–∞—Ö

‚Üí –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `VERIFICATION_CHECKLIST.md` –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

1. –ò–∑—É—á–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –≤ —ç—Ç–æ–π –ø–∞–ø–∫–µ
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á–µ–∫–ª–∏—Å—Ç `VERIFICATION_CHECKLIST.md`
3. –í–∫–ª—é—á–∏—Ç–µ `DEBUG_PROMPTS=true` –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –ª–æ–≥–æ–≤
4. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∫–æ–º–∞–Ω–¥–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

## üéâ –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä—å –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ. –ê–≥–µ–Ω—Ç—ã –∏–º–µ—é—Ç –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫:

- ‚úÖ –ò—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–∞
- ‚úÖ –ö–æ–Ω—Ç–µ–∫—Å—Ç—É —Å–æ–±—ã—Ç–∏–π
- ‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
- ‚úÖ –í—Ä–µ–º–µ–Ω–Ω—ã–º –¥–∞–Ω–Ω—ã–º

---

**–í–µ—Ä—Å–∏—è:** 1.0.0  
**–î–∞—Ç–∞:** 14 –æ–∫—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
